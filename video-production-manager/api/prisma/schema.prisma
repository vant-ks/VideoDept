generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model cameras {
  id                 String      @id
  production_id      String
  name               String
  model              String?
  format_mode        String?
  lens_type          String?
  max_zoom           Float?
  shooting_distance  Float?
  calculated_zoom    Float?
  has_tripod         Boolean?
  has_short_tripod   Boolean?
  has_dolly          Boolean?
  has_jib            Boolean?
  ccu_id             String?
  smpte_cable_length Float?
  note               String?
  created_at         DateTime    @default(now())
  updated_at         DateTime
  synced_at          DateTime?
  last_modified_by   String?
  version            Int         @default(1)
  is_deleted         Boolean     @default(false)
  ccus               ccus?       @relation(fields: [ccu_id], references: [id])
  productions        productions @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@index([ccu_id])
  @@index([production_id])
}

model ccus {
  id              String      @id
  production_id   String
  name            String
  manufacturer    String?
  model           String?
  format_mode     String?
  fiber_input     String?
  reference_input String?
  outputs         Json?
  note            String?
  created_at      DateTime    @default(now())
  updated_at      DateTime
  synced_at       DateTime?
  last_modified_by String?
  version         Int         @default(1)
  is_deleted      Boolean     @default(false)
  cameras         cameras[]
  productions     productions @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@index([production_id])
}

model checklist_items {
  id            String      @id
  production_id String
  title         String
  completed     Boolean     @default(false)
  sort_order    Int?
  created_at    DateTime    @default(now())
  updated_at    DateTime
  last_modified_by String?
  version       Int         @default(1)
  productions   productions @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@index([production_id])
}

model connections {
  id                  String      @id
  production_id       String
  source_id           String?
  source_output_id    String?
  intermediate_type   String?
  intermediate_id     String?
  intermediate_input  String?
  intermediate_output String?
  destination_type    String
  destination_id      String?
  signal_path         Json?
  note                String?
  created_at          DateTime    @default(now())
  updated_at          DateTime
  synced_at           DateTime?
  last_modified_by    String?
  version             Int         @default(1)
  is_deleted          Boolean     @default(false)
  productions         productions @relation(fields: [production_id], references: [id], onDelete: Cascade)
  sources             sources?    @relation(fields: [source_id], references: [id])

  @@index([production_id])
  @@index([source_id])
}

model connector_types {
  id         String   @id
  name       String   @unique
  sort_order Int      @default(0)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([sort_order, is_active])
}

model equipment_card_io {
  id              String          @id
  card_id         String
  port_type       PortType
  io_type         String
  label           String?
  format          String?
  port_index      Int?
  created_at      DateTime        @default(now())
  updated_at      DateTime
  version         Int             @default(1)
  equipment_cards equipment_cards @relation(fields: [card_id], references: [id], onDelete: Cascade)

  @@index([card_id])
}

model equipment_cards {
  id                String              @id
  equipment_id      String
  slot_number       Int
  created_at        DateTime            @default(now())
  updated_at        DateTime
  version           Int                 @default(1)
  equipment_card_io equipment_card_io[]
  equipment_specs   equipment_specs     @relation(fields: [equipment_id], references: [id], onDelete: Cascade)

  @@unique([equipment_id, slot_number])
}

model equipment_io_ports {
  id              String          @id
  equipment_id    String
  port_type       PortType
  io_type         String
  label           String?
  format          String?
  port_index      Int?
  created_at      DateTime        @default(now())
  updated_at      DateTime
  version         Int             @default(1)
  equipment_specs equipment_specs @relation(fields: [equipment_id], references: [id], onDelete: Cascade)

  @@index([equipment_id])
}

model equipment_specs {
  id                  String               @id
  category            EquipmentCategory
  manufacturer        String
  model               String
  io_architecture     IoArchitecture
  card_slots          Int?
  format_by_io        Boolean              @default(true)
  is_secondary_device Boolean              @default(false)
  device_formats      Json?
  specs               Json?
  created_at          DateTime             @default(now())
  updated_at          DateTime
  synced_at           DateTime?
  last_modified_by    String?
  version             Int                  @default(1)
  is_deleted          Boolean              @default(false)
  equipment_cards     equipment_cards[]
  equipment_io_ports  equipment_io_ports[]

  @@index([category, is_deleted])
  @@index([is_secondary_device])
}

model events {
  id            String         @id
  production_id String
  event_type    EventType
  operation     EventOperation
  entity_id     String
  entity_data   Json?
  changes       Json?
  user_id       String
  user_name     String?
  version       Int            @default(1)
  timestamp     DateTime       @default(now())
  productions   productions    @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@index([production_id, entity_id])
  @@index([production_id, event_type])
  @@index([production_id, timestamp])
}

model frame_rates {
  id         String   @id
  rate       String   @unique
  sort_order Int      @default(0)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([sort_order, is_active])
}

model ip_addresses {
  id            String      @id
  production_id String
  ip            String
  device_name   String
  category      String
  subnet        String?
  gateway       String?
  note          String?
  created_at    DateTime    @default(now())
  updated_at    DateTime
  last_modified_by String?
  version       Int         @default(1)
  productions   productions @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@unique([production_id, ip])
  @@index([production_id])
}

model productions {
  id               String            @id
  client           String
  show_name        String
  venue            String?
  room             String?
  load_in          DateTime?
  load_out         DateTime?
  show_info_url    String?
  status           ProductionStatus  @default(PLANNING)
  created_at       DateTime          @default(now())
  updated_at       DateTime
  synced_at        DateTime?
  last_modified_by String?
  version          Int               @default(1)
  field_versions   Json?
  is_deleted       Boolean           @default(false)
  cameras          cameras[]
  ccus             ccus[]
  checklist_items  checklist_items[]
  connections      connections[]
  events           events[]
  ip_addresses     ip_addresses[]
  sends            sends[]
  sources          sources[]

  @@index([status, is_deleted])
}

model resolution_presets {
  id         String   @id
  name       String   @unique
  sort_order Int      @default(0)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([sort_order, is_active])
}

model sends {
  id               String      @id
  production_id    String
  type             String
  name             String
  h_res            Int?
  v_res            Int?
  rate             Float?
  standard         String?
  note             String?
  secondary_device String?
  output_connector String?
  created_at       DateTime    @default(now())
  updated_at       DateTime
  synced_at        DateTime?
  last_modified_by String?
  version          Int         @default(1)
  is_deleted       Boolean     @default(false)
  productions      productions @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@index([production_id, is_deleted])
  @@index([type])
}

model server_registry {
  id             String   @id
  server_name    String
  ip_address     String
  port           Int
  is_active      Boolean  @default(true)
  last_heartbeat DateTime
  created_at     DateTime @default(now())
  updated_at     DateTime

  @@index([is_active, last_heartbeat])
}

model settings {
  id         String   @id
  key        String   @unique
  value      Json
  category   String?
  created_at DateTime @default(now())
  updated_at DateTime
}

model source_outputs {
  id           String   @id
  source_id    String
  connector    String
  output_index Int      @default(1)
  created_at   DateTime @default(now())
  version      Int      @default(1)
  h_res        Int?
  rate         Float?
  standard     String?
  v_res        Int?
  sources      sources  @relation(fields: [source_id], references: [id], onDelete: Cascade)

  @@index([source_id])
}

model source_types {
  id         String   @id
  name       String   @unique
  sort_order Int      @default(0)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([sort_order, is_active])
}

model sources {
  id                     String           @id
  production_id          String
  type                   String
  name                   String
  h_res                  Int?
  v_res                  Int?
  rate                   Float?
  standard               String?
  note                   String?
  secondary_device       String?
  blanking               String?
  created_at             DateTime         @default(now())
  updated_at             DateTime
  synced_at              DateTime?
  last_modified_by       String?
  version                Int              @default(1)
  is_deleted             Boolean          @default(false)
  format_assignment_mode String?          @default("system-wide")
  connections            connections[]
  source_outputs         source_outputs[]
  productions            productions      @relation(fields: [production_id], references: [id], onDelete: Cascade)

  @@index([production_id, is_deleted])
  @@index([type])
}

model sync_conflicts {
  id               String             @id
  table_name       String
  record_id        String
  cloud_version    Int?
  local_version    Int?
  cloud_data       Json?
  local_data       Json?
  cloud_updated_at DateTime?
  local_updated_at DateTime?
  resolution       ConflictResolution @default(PENDING)
  resolved_at      DateTime?
  resolved_by      String?
  created_at       DateTime           @default(now())
}

model sync_log {
  id                 String        @id
  sync_direction     SyncDirection
  started_at         DateTime      @default(now())
  completed_at       DateTime?
  status             SyncStatus
  records_synced     Int           @default(0)
  conflicts_detected Int           @default(0)
  errors             Json?
  server_id          String?
  created_at         DateTime      @default(now())
}

enum ConflictResolution {
  PENDING
  CLOUD_WINS
  LOCAL_WINS
  MANUAL
}

enum EquipmentCategory {
  CAMERA
  CCU
  CAM_SWITCHER
  VISION_SWITCHER
  ROUTER
  LED_PROCESSOR
  LED_TILE
  PROJECTOR
  RECORDER
  MONITOR
  CONVERTER
}

enum EventOperation {
  CREATE
  UPDATE
  DELETE
}

enum EventType {
  SOURCE
  SEND
  CAMERA
  CCU
  MEDIA_SERVER
  VIDEO_SWITCHER
  ROUTER
  CABLE_SNAKE
  PROJECTION_SCREEN
  LED_SCREEN
  COMPUTER
  IP_ADDRESS
  CHECKLIST_ITEM
  PRODUCTION
}

enum IoArchitecture {
  DIRECT
  CARD_BASED
}

enum PortType {
  INPUT
  OUTPUT
}

enum ProductionStatus {
  PLANNING
  READY
  ACTIVE
  COMPLETED
  ARCHIVED
}

enum SyncDirection {
  UPLOAD
  DOWNLOAD
  BIDIRECTIONAL
}

enum SyncStatus {
  STARTED
  COMPLETED
  FAILED
  PARTIAL
}
